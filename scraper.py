#!/usr/bin/env python

import argparse
import os
import shutil


def perform(log_file, save_dir):
    with open(log_file, 'r') as log:
        for path in log:
            path = path.strip()
            try:
                if os.path.isfile(path):
                    if path:
                        path_dir = os.path.dirname(path)
                        final_dir = save_dir + '/' + path_dir
                        if not os.path.exists(final_dir):
                            os.makedirs(final_dir)
                            shutil.copy(path, final_dir)
            except:
                print("[-] Failed to copy " + path)


def main():
    parser = argparse.ArgumentParser(description='Parse line based filepath file and copy files to designated destination')
    parser.add_argument('-l','--log', nargs='?', help='the line delimited log file with file paths to read')
    parser.add_argument('-s','--save', nargs='?', help='must be a valid directory where to copy the read files to')
    parsed = parser.parse_args()

    log_file_location = ''
    save_file_location = ''

    if parsed.log:
        log_file_location = parsed.log

    if parsed.save:
        save_file_location = parsed.save

    if not save_file_location or not log_file_location:
        parser.parse_args(['-h'])
        exit(-1)

    perform(log_file_location, save_file_location)

if __name__ == "__main__":
    main()
